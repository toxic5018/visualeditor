<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VisualEditor</title>
  <!-- Favicon (shows as browser tab icon) -->
  <link rel="icon" href="https://i.postimg.cc/JhYSF2V3/image-ic-visualeditor.png" type="image/png">
  <!-- Noto Sans Font -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* Disable dragging for all images */
    img {
      -webkit-user-drag: none;
      -khtml-user-drag: none;
      -moz-user-drag: none;
      -o-user-drag: none;
      user-drag: none;
    }
    /* Global & UI Styles */
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Noto Sans', sans-serif; background: #121212; color: #e0e0e0; }
    /* Disable text selection for everything except textareas and inputs (i.e. code remains selectable) */
    body *:not(textarea):not(input) { user-select: none; }
    button { font-family: 'Noto Sans', sans-serif; background: #3498db; color: #fff; border: none; padding: 10px 20px; cursor: pointer; font-size: 16px; margin: 5px; border-radius: 0; }
    button:hover { background: #2980b9; }
    select { border-radius: 0; }
    /* Slider customization */
    input[type=range] {
      -webkit-appearance: none; width: 100%; height: 6px; background: #444; outline: none;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none; width: 14px; height: 14px; background: #3498db; cursor: pointer;
    }
    input[type=range]::-moz-range-thumb {
      width: 14px; height: 14px; background: #3498db; cursor: pointer;
    }
    /* Disable resizing on modal textareas */
    .modal-field textarea { resize: none; }
    /* Taskbar */
    .taskbar { width: 100%; background: #273c56; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; }
    .taskbar .left { display: flex; align-items: center; }
    .taskbar .left img { height: 30px; margin-right: 10px; }
    .taskbar h1 { margin: 0; font-size: 20px; }
    .taskbar .right { display: flex; align-items: center; }
    .taskbar .right a { color: lightgray; text-decoration: none; margin-right: 10px; }
    /* Main content */
    .main { padding: 20px; }
    .welcome-screen { font-size: 26px; margin-bottom: 20px; }
    .welcome-screen img { height: 40px; vertical-align: middle; margin-right: 10px; }
    .project-list { margin-top: 20px; }
    .project-item { display: flex; align-items: center; justify-content: space-between; padding: 10px; border: 1px solid #444; margin-bottom: 5px; cursor: pointer; }
    .trash-btn { background: transparent; border: none; color: #e0e0e0; cursor: pointer; font-size: 18px; margin-left: auto; }
    /* Modal styles */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); 
            align-items: center; justify-content: center; animation: fadeIn 0.3s; z-index: 1000; }
    /* Ensure popups appear above the editor */
    #editProjectModal, #saveAsModal, #downloadPopupModal, #confirmDeleteModal, #aboutModal, #importProjectModal, #templateModal { z-index: 1200; }
    .modal-content { background: #2e2e2e; padding: 20px; border: 1px solid #555; width: 400px; }
    .modal-header { font-size: 20px; margin-bottom: 10px; }
    .modal-field { margin-bottom: 10px; }
    .modal-field label { display: block; margin-bottom: 5px; }
    .modal-field input[type="text"], .modal-field textarea, .modal-field select {
      width: 100%; padding: 5px; background: #444; border: 1px solid #666; color: #e0e0e0;
    }
    /* Download popup animation */
    @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    #downloadPopupModal .modal-content { width: 300px; animation: slideUp 0.5s ease forwards; }
    /* About modal (white background) */
    #aboutModal .modal-content { width: 500px; background: #fff; color: #000; padding: 20px; }
    #aboutModal .modal-header { font-size: 28px; font-weight: bold; text-align: center; }
    /* Editor modal & header */
    .editor-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1e1e1e; z-index: 1100; flex-direction: column; overflow: hidden; }
    .editor-header { display: flex; justify-content: space-between; align-items: center; background: #2e2e2e; padding: 10px; border-bottom: 1px solid #555; flex-wrap: wrap; }
    .project-info { font-size: 18px; }
    .project-info span:first-child { color: lightgray; }
    #displayTitle { color: #fff; font-weight: bold; }
    #displayDesc { color: #aaa; }
    .editor-actions { display: flex; align-items: center; flex-wrap: wrap; }
    .editor-actions button { margin-left: 10px; }
    .btn-run { background: #28a745; }
    .btn-pause { background: #ffc107; color: #000; }
    .btn-stop { background: #dc3545; }
    /* Fullscreen taskbar */
    .fullscreen-taskbar { display: none; position: absolute; top: 0; left: 0; width: 100%; background: #2e2e2e; padding: 5px; z-index: 1150; align-items: center; }
    /* Editor body */
    .editor-body { display: flex; flex: 1; overflow: hidden; }
    /* Fixed code area (no horizontal stretch) */
    .code-area { flex: 0 0 500px; padding: 10px; overflow: hidden; }
    .code-editor-container { display: flex; height: 100%; }
    .line-numbers { width: 40px; background: #333; color: #aaa; text-align: right; padding: 10px 5px; font-family: monospace; line-height: 1.4; overflow: hidden; }
    .code-area textarea { flex: 1; padding: 10px; background: #121212; color: #e0e0e0; border: none; outline: none; font-family: monospace; font-size: 14px; height: 100%; resize: none; overflow-y: scroll; }
    .code-area textarea::-webkit-scrollbar { width: 8px; }
    .code-area textarea::-webkit-scrollbar-track { background: #2e2e2e; }
    .code-area textarea::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
    .code-area textarea { scrollbar-width: thin; scrollbar-color: #555 #2e2e2e; }
    /* Vertical resizer for HTML view */
    .vertical-resizer { height: 5px; background: #444; cursor: ns-resize; }
    .right-panel { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .html-view { flex: 2; overflow: auto; background: #222; padding: 10px; }
    .command-log { flex: 1; overflow-y: auto; background: #2e2e2e; padding: 10px; }
    .log-entry { display: flex; justify-content: space-between; font-family: monospace; margin-bottom: 2px; }
    .log-text { color: #fff; }
    .log-time { color: #aaa; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    /* Fade out animation */
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    .fade-out { animation: fadeOut 0.3s forwards; }
    /* Fullscreen mode */
    .editor-modal.fullscreen-mode .code-area { display: none; }
    /* Template box styles */
    .template-box { background: #444; color: #e0e0e0; padding: 10px; cursor: pointer; text-align: center; }
    .template-box.selected { border: 2px solid #3498db; }
  </style>
</head>
<body>
  <!-- Top Taskbar -->
  <div class="taskbar">
    <div class="left">
      <img src="https://i.postimg.cc/JhYSF2V3/image-ic-visualeditor.png" alt="Icon" draggable="false">
      <h1>VisualEditor</h1>
    </div>
    <div class="right">
      <a href="#" id="aboutLink" style="color: lightgray;">About</a>
      <button id="downloadTaskbarBtn">Download App</button>
    </div>
  </div>
  <!-- Main Content -->
  <div class="main">
    <div class="welcome-screen">
      <img src="https://i.postimg.cc/JhYSF2V3/image-ic-visualeditor.png" alt="Icon" draggable="false">
      Welcome to VisualEditor
    </div>
    <button id="createProjectBtn">Create Project</button>
    <button id="importProjectBtn">Import Project</button>
    <div class="project-list" id="projectList"></div>
  </div>
  <!-- About Modal -->
  <div class="modal" id="aboutModal">
    <div class="modal-content" style="background:#fff; color:#000;">
      <div class="modal-header">
        <img src="https://i.postimg.cc/JhYSF2V3/image-ic-visualeditor.png" alt="Icon" style="height:50px; vertical-align:middle;" draggable="false"> VisualEditor
      </div>
      <div style="text-align:center; font-size:16px; margin-bottom:10px;">
        Version 1.0.0 (up to date ðŸ’¯)
      </div>
      <div style="text-align:center; margin-bottom:10px;">
        <a href="https://discord.com/invite/KjEZtRmWwc" target="_blank" style="margin: 0 10px;">Discord</a>
        <a href="https://www.youtube.com/@toxic5018.2" target="_blank" style="margin: 0 10px;">YouTube</a>
        <a href="https://x.com/picture1080X" target="_blank" style="margin: 0 10px;">Twitter</a>
      </div>
      <div style="text-align:center; font-size:16px; margin-bottom:10px;">
        Created by Toxic5018
      </div>
      <div style="text-align:center; font-size:14px; color:lightgray; margin-bottom:10px;">
        VisualEditor is a powerful yet lightweight code editor designed to help you quickly prototype, test, and debug your web projectsâ€”all within your browser.
      </div>
      <div style="text-align:center; margin-top:10px;">
        Compatibility with this website:
        <div style="display:flex; justify-content:center; gap:20px; margin-top:10px;">
          <img src="https://static-00.iconduck.com/assets.00/html-icon-1451x2048-69sehqrp.png" alt="HTML" style="height:40px;" draggable="false">
          <img src="https://static-00.iconduck.com/assets.00/css-3-icon-726x1024-610441pl.png" alt="CSS" style="height:40px;" draggable="false">
          <img src="https://img.icons8.com/color/512/javascript.png" alt="JS" style="height:40px;" draggable="false">
        </div>
      </div>
      <div style="text-align:center; margin-top:20px;">
        <button id="aboutCloseBtn">Close</button>
      </div>
    </div>
  </div>
  <!-- Create Project Modal -->
  <div class="modal" id="createProjectModal">
    <div class="modal-content">
      <div class="modal-header">Create New Project</div>
      <div class="modal-field">
        <label for="projectTitle">Title:</label>
        <input type="text" id="projectTitle" placeholder="Project Title">
      </div>
      <div class="modal-field">
        <label>Version:</label>
        <div class="version-sliders">
          <input type="range" id="versionMajor" min="0" max="9" value="1"><span id="majorDisplay">1</span>
          <span>.</span>
          <input type="range" id="versionMinor" min="0" max="9" value="0"><span id="minorDisplay">0</span>
          <span>.</span>
          <input type="range" id="versionPatch" min="0" max="9" value="0"><span id="patchDisplay">0</span>
        </div>
      </div>
      <div class="modal-field">
        <button id="selectTemplateBtn" style="background: #555; color: #fff; width: 100%;">Select Template</button>
      </div>
      <div class="modal-field">
        <label for="projectDescription">Description:</label>
        <textarea id="projectDescription" rows="3" placeholder="Project Description"></textarea>
      </div>
      <div style="text-align:right;">
        <button id="createProjectConfirmBtn">Create</button>
        <button id="createProjectCancelBtn">Cancel</button>
      </div>
    </div>
  </div>
  <!-- Template Selection Modal -->
  <div class="modal" id="templateModal">
    <div class="modal-content">
      <div class="modal-header">Select a Template</div>
      <div id="templateGrid" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px;">
        <div class="template-box" data-template="empty">Empty</div>
        <div class="template-box" data-template="helloWorld">
          Hello World<br>
          <small>(<h1>Hello</h1>...)</small>
        </div>
        <div class="template-box" data-template="websiteExample">
          Website Example<br>
          <small>Sample Website</small>
        </div>
      </div>
      <div style="text-align:right; margin-top:10px;">
        <button id="templateSelectBtn">Select</button>
        <button id="templateCancelBtn">Cancel</button>
      </div>
    </div>
  </div>
  <!-- Edit Project Modal -->
  <div class="modal" id="editProjectModal">
    <div class="modal-content">
      <div class="modal-header">Edit Project</div>
      <div class="modal-field">
        <label for="editProjectTitle">Title:</label>
        <input type="text" id="editProjectTitle" placeholder="Project Title">
      </div>
      <div class="modal-field">
        <label for="editProjectDescription">Description:</label>
        <textarea id="editProjectDescription" rows="3" placeholder="Project Description"></textarea>
      </div>
      <div class="modal-field">
        <label>Version:</label>
        <div class="version-sliders">
          <input type="range" id="editVersionMajor" min="0" max="9" value="1"><span id="editMajorDisplay">1</span>
          <span>.</span>
          <input type="range" id="editVersionMinor" min="0" max="9" value="0"><span id="editMinorDisplay">0</span>
          <span>.</span>
          <input type="range" id="editVersionPatch" min="0" max="9" value="0"><span id="editPatchDisplay">0</span>
        </div>
      </div>
      <div style="text-align:right;">
        <button id="updateProjectBtn">Update</button>
        <button id="editProjectCancelBtn">Cancel</button>
      </div>
    </div>
  </div>
  <!-- Save As Modal -->
  <div class="modal" id="saveAsModal">
    <div class="modal-content">
      <div class="modal-header">Save As</div>
      <div class="modal-field">
        <label for="saveAsFileName">File Name:</label>
        <input type="text" id="saveAsFileName" placeholder="Enter file name">
      </div>
      <div class="modal-field">
        <label for="saveAsAuthor">Author:</label>
        <input type="text" id="saveAsAuthor" placeholder="Enter author name">
      </div>
      <div class="modal-field">
        <label for="saveAsFormat">Format:</label>
        <select id="saveAsFormat">
          <option value=".txt">.txt</option>
          <option value=".html">.html</option>
          <option value=".json">.json</option>
          <option value=".js">.js</option>
        </select>
      </div>
      <div class="modal-field">
        <label>Version: <span id="saveAsVersion"></span></label>
      </div>
      <div style="text-align:right;">
        <button id="saveAsConfirmBtn">Save</button>
        <button id="saveAsCancelBtn">Cancel</button>
      </div>
    </div>
  </div>
  <!-- Confirm Delete Modal -->
  <div class="modal" id="confirmDeleteModal">
    <div class="modal-content">
      <div class="modal-header">Confirm Delete</div>
      <div class="modal-field">
        <p>Are you sure you want to remove this project? Your progress from here will be forever gone...</p>
      </div>
      <div style="text-align:right;">
        <button id="confirmDeleteAgreeBtn">I agree</button>
        <button id="confirmDeleteCancelBtn">Cancel</button>
      </div>
    </div>
  </div>
  <!-- Download Popup Modal -->
  <div class="modal" id="downloadPopupModal">
    <div class="modal-content">
      <div class="modal-header">Download Instructions</div>
      <div class="modal-field">
        <p>1. Click the Download button below.</p>
        <p>2. Save the file from your browser.</p>
        <p>3. Enjoy your app!</p>
      </div>
      <div style="text-align:right;">
        <button id="downloadStartBtn">Download</button>
        <button id="downloadCancelBtn">Cancel</button>
      </div>
    </div>
  </div>
  <!-- Import Project Modal -->
  <div class="modal" id="importProjectModal">
    <div class="modal-content">
      <div class="modal-header">Import Project</div>
      <div class="modal-field">
        <label for="importProjectFile">Upload .html file:</label>
        <input type="file" id="importProjectFile" accept=".html">
      </div>
      <div style="text-align:right;">
        <button id="importProjectCreateBtn" disabled>Create</button>
        <button id="importProjectCancelBtn">Cancel</button>
      </div>
    </div>
  </div>
  <!-- Fullscreen Taskbar -->
  <div class="fullscreen-taskbar" id="fullscreenTaskbar">
    <span style="color: lightgray; flex:1;">VisualEditor Fullscreen</span>
    <button id="fullscreenRunBtn" class="btn-run">Run</button>
    <button id="fullscreenPauseBtn" class="btn-pause">Pause</button>
    <button id="fullscreenStopBtn" class="btn-stop">Stop</button>
    <button id="exitFullscreenBtn" style="background:none;border:none;color:#e0e0e0;font-size:16px;cursor:pointer;">Exit Fullscreen</button>
  </div>
  <!-- Editor Modal -->
  <div class="editor-modal" id="projectEditorModal">
    <div class="editor-header">
      <div class="project-info">
        <span>VisualEditor </span>
        <span id="displayTitle"></span>
        <span style="color:#aaa;"> | </span>
        <span id="displayDesc"></span>
      </div>
      <div class="editor-actions">
        <span id="autosaveLabel" style="color:#aaa;margin-right:10px;"></span>
        <button id="runBtn" class="btn-run">Run</button>
        <button id="pauseBtn" class="btn-pause">Pause</button>
        <button id="stopBtn" class="btn-stop">Stop</button>
        <button id="saveAsBtn">Save as</button>
        <button id="editProjectBtn">Edit Project</button>
        <button id="fullscreenBtn">Fullscreen</button>
        <button id="closeProjectBtn">Close</button>
      </div>
    </div>
    <div class="editor-body">
      <div class="code-area">
        <div class="code-editor-container">
          <div class="line-numbers" id="lineNumbers">01</div>
          <textarea id="codeEditor" placeholder="Write your code here..."></textarea>
        </div>
      </div>
      <div class="right-panel">
        <div class="html-view" id="htmlView"></div>
        <div class="vertical-resizer" id="verticalResizer"></div>
        <div class="command-log" id="commandLog"></div>
      </div>
    </div>
  </div>
  <script>
    const $ = id => document.getElementById(id);
    let projects = [], currentProject = null, projectSaved = false, isPaused = false,
        autosaveTimeoutId, deleteCandidate = null, downloadCountdownInterval,
        selectedTemplateCode = "";
    let selectedTemplateKey = null;
    const templates = {
      empty: { name: "Empty", code: "" },
      helloWorld: { name: "Hello World", code: "<h1> Hello </h1>\n<h2> Hello </h2>\n<h3> Hello </h3>\n<h4> Hello </h4>\n\n<h1> World </h1>\n<h2> World </h2>\n<h3> World </h3>\n<h4> World </h4>" },
      websiteExample: { name: "Website Example", code: "<!DOCTYPE html>\n<html>\n<head>\n  <title>My Website</title>\n  <style>\n    body { font-family: sans-serif; margin: 20px; }\n  </style>\n</head>\n<body>\n  <header>\n    <h1>Welcome to My Website</h1>\n  </header>\n  <main>\n    <p>This is a sample website template.</p>\n  </main>\n  <footer>\n    <p>Footer info here.</p>\n  </footer>\n</body>\n</html>" }
    };
    // Modal functions with fade-out animation
    function showModal(m) {
      m.classList.remove("fade-out");
      m.style.display = "flex";
    }
    function hideModal(m) {
      m.classList.add("fade-out");
      setTimeout(() => {
        m.style.display = "none";
        m.classList.remove("fade-out");
      }, 300);
    }
    function formatDate(d) {
      return d.toLocaleDateString() + " " + d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    function saveProjectsToLocalStorage() {
      localStorage.setItem("visualEditorProjects", JSON.stringify(projects));
    }
    // Load saved projects on page load
    document.addEventListener("DOMContentLoaded", () => {
      const saved = localStorage.getItem("visualEditorProjects");
      if (saved) {
        projects = JSON.parse(saved);
        renderProjectList();
      }
    });
    function updateProjectInfo() {
      if (!currentProject) return;
      displayTitle.textContent = currentProject.title;
      displayDesc.textContent = (currentProject.description || "").slice(0, 25) + ((currentProject.description && currentProject.description.length > 25) ? "..." : "");
    }
    function logMessage(msg) {
      const entry = document.createElement("div"); entry.className = "log-entry";
      const text = document.createElement("span"); text.className = "log-text"; text.textContent = msg;
      const time = document.createElement("span"); time.className = "log-time"; time.textContent = formatDate(new Date());
      entry.append(text, time);
      commandLog.appendChild(entry);
      commandLog.scrollTop = commandLog.scrollHeight;
    }
    function renderProjectList() {
      projectList.innerHTML = "";
      projects.forEach(p => {
        const item = document.createElement("div"); item.className = "project-item";
        const left = document.createElement("div"); left.className = "icon";
        left.innerHTML = '<span class="material-icons">folder</span> ' + p.title;
        const right = document.createElement("div"); right.className = "updated-time";
        right.textContent = "Updated " + formatDate(new Date(p.updated));
        const trash = document.createElement("button"); trash.className = "trash-btn";
        trash.innerHTML = '<span class="material-icons">delete</span>';
        item.append(left, right, trash);
        item.addEventListener("click", e => { if (e.target.closest(".trash-btn")) return; currentProject = p; openEditor(); });
        trash.addEventListener("click", e => { e.stopPropagation(); deleteCandidate = p; showModal(confirmDeleteModal); });
        projectList.prepend(item);
      });
    }
    // Delete confirmation
    const confirmDeleteAgreeBtn = $("confirmDeleteAgreeBtn"),
          confirmDeleteCancelBtn = $("confirmDeleteCancelBtn");
    confirmDeleteAgreeBtn.addEventListener("click", () => {
      if (deleteCandidate) {
        projects = projects.filter(pr => pr !== deleteCandidate);
        if (currentProject === deleteCandidate) hideModal(projectEditorModal);
        renderProjectList();
        saveProjectsToLocalStorage();
        deleteCandidate = null;
      }
      hideModal(confirmDeleteModal);
    });
    confirmDeleteCancelBtn.addEventListener("click", () => { deleteCandidate = null; hideModal(confirmDeleteModal); });
    // Download App functionality
    const downloadTaskbarBtn = $("downloadTaskbarBtn"),
          downloadPopupModal = $("downloadPopupModal"),
          downloadStartBtn = $("downloadStartBtn"),
          downloadCancelBtn = $("downloadCancelBtn");
    downloadTaskbarBtn.addEventListener("click", () => {
      if (!currentProject) return;
      showModal(downloadPopupModal);
    });
    downloadCancelBtn.addEventListener("click", () => {
      clearInterval(downloadCountdownInterval);
      downloadStartBtn.disabled = false;
      downloadStartBtn.textContent = "Download";
      hideModal(downloadPopupModal);
    });
    downloadStartBtn.addEventListener("click", () => {
      let countdown = 5;
      downloadStartBtn.disabled = true;
      downloadStartBtn.textContent = "Download (" + countdown + ")";
      downloadCountdownInterval = setInterval(() => {
        countdown--;
        if (countdown > 0) {
          downloadStartBtn.textContent = "Download (" + countdown + ")";
        } else {
          clearInterval(downloadCountdownInterval);
          const blob = new Blob([codeEditor.value], { type: "text/plain" }),
                url = URL.createObjectURL(blob),
                a = document.createElement("a");
          a.href = url;
          a.download = currentProject.title.replace(/\s+/g, "_") + ".txt";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          downloadStartBtn.disabled = false;
          downloadStartBtn.textContent = "Download";
          hideModal(downloadPopupModal);
        }
      }, 1000);
    });
    // About modal functionality
    const aboutModal = $("aboutModal"),
          aboutLink = $("aboutLink"),
          aboutCloseBtn = $("aboutCloseBtn");
    aboutLink.addEventListener("click", e => { e.preventDefault(); showModal(aboutModal); });
    aboutCloseBtn.addEventListener("click", () => { hideModal(aboutModal); });
    // Create Project modal functionality
    const createProjectBtn = $("createProjectBtn"),
          createProjectModal = $("createProjectModal"),
          createProjectConfirmBtn = $("createProjectConfirmBtn"),
          createProjectCancelBtn = $("createProjectCancelBtn"),
          projectTitleInput = $("projectTitle"),
          projectDescriptionInput = $("projectDescription"),
          versionMajor = $("versionMajor"),
          versionMinor = $("versionMinor"),
          versionPatch = $("versionPatch"),
          majorDisplay = $("majorDisplay"),
          minorDisplay = $("minorDisplay"),
          patchDisplay = $("patchDisplay");
    createProjectBtn.addEventListener("click", () => {
      projectTitleInput.value = "";
      projectDescriptionInput.value = "";
      versionMajor.value = 1; versionMinor.value = 0; versionPatch.value = 0;
      majorDisplay.textContent = "1"; minorDisplay.textContent = "0"; patchDisplay.textContent = "0";
      // Reset template selection
      selectedTemplateCode = "";
      selectedTemplateKey = null;
      $("selectTemplateBtn").textContent = "Select Template";
      showModal(createProjectModal);
    });
    createProjectCancelBtn.addEventListener("click", () => hideModal(createProjectModal));
    createProjectConfirmBtn.addEventListener("click", () => {
      const title = projectTitleInput.value.trim() || "Untitled Project",
            desc = projectDescriptionInput.value.trim() || "",
            ver = versionMajor.value + "." + versionMinor.value + "." + versionPatch.value,
            newP = { title, description: desc, version: ver, code: selectedTemplateCode, updated: new Date() };
      projects.push(newP);
      currentProject = newP;
      hideModal(createProjectModal);
      renderProjectList();
      saveProjectsToLocalStorage();
      openEditor();
    });
    // Import Project modal functionality
    const importProjectBtn = $("importProjectBtn"),
          importProjectModal = $("importProjectModal"),
          importProjectFile = $("importProjectFile"),
          importProjectCreateBtn = $("importProjectCreateBtn"),
          importProjectCancelBtn = $("importProjectCancelBtn");
    importProjectBtn.addEventListener("click", () => {
      importProjectFile.value = "";
      importProjectCreateBtn.disabled = true;
      showModal(importProjectModal);
    });
    importProjectFile.addEventListener("change", e => {
      if (e.target.files && e.target.files.length > 0) {
        importProjectCreateBtn.disabled = false;
      } else {
        importProjectCreateBtn.disabled = true;
      }
    });
    importProjectCreateBtn.addEventListener("click", () => {
      const file = importProjectFile.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const fileContent = event.target.result, fileName = file.name.replace(/\.[^/.]+$/, ""),
                newP = { title: fileName, description: "", version: "1.0.0", code: fileContent, updated: new Date() };
          projects.push(newP);
          currentProject = newP;
          renderProjectList();
          saveProjectsToLocalStorage();
          openEditor();
          hideModal(importProjectModal);
        };
        reader.readAsText(file);
      }
    });
    importProjectCancelBtn.addEventListener("click", () => { hideModal(importProjectModal); });
    function openEditor() {
      projectSaved = false;
      codeEditor.value = currentProject.code;
      updateProjectInfo();
      htmlView.innerHTML = "";
      commandLog.innerHTML = "";
      updateLineNumbers();
      showModal(projectEditorModal);
    }
    function saveProject() {
      currentProject.code = codeEditor.value;
      currentProject.updated = new Date();
      projectSaved = true;
      logMessage("Project saved at " + formatDate(new Date(currentProject.updated)));
      renderProjectList();
      saveProjectsToLocalStorage();
    }
    const closeProjectBtn = $("closeProjectBtn");
    closeProjectBtn.addEventListener("click", () => { saveProject(); hideModal(projectEditorModal); });
    const saveAsBtn = $("saveAsBtn"),
          saveAsModal = $("saveAsModal"),
          saveAsFileName = $("saveAsFileName"),
          saveAsAuthor = $("saveAsAuthor"),
          saveAsFormat = $("saveAsFormat"),
          saveAsVersion = $("saveAsVersion"),
          saveAsConfirmBtn = $("saveAsConfirmBtn"),
          saveAsCancelBtn = $("saveAsCancelBtn");
    saveAsBtn.addEventListener("click", () => {
      if (!currentProject) return;
      saveAsFileName.value = currentProject.title;
      saveAsAuthor.value = "";
      saveAsFormat.value = ".txt";
      saveAsVersion.textContent = currentProject.version;
      showModal(saveAsModal);
    });
    saveAsCancelBtn.addEventListener("click", () => hideModal(saveAsModal));
    saveAsConfirmBtn.addEventListener("click", () => {
      if (!currentProject) return;
      const fn = saveAsFileName.value.trim() || currentProject.title, ext = saveAsFormat.value,
            blob = new Blob([codeEditor.value], { type: "text/plain" }),
            url = URL.createObjectURL(blob),
            a = document.createElement("a");
      a.href = url;
      a.download = fn.replace(/\s+/g, "_") + ext;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      hideModal(saveAsModal);
    });
    const editProjectBtn = $("editProjectBtn"),
          editProjectModal = $("editProjectModal"),
          editProjectTitle = $("editProjectTitle"),
          editProjectDescription = $("editProjectDescription"),
          editVersionMajor = $("editVersionMajor"),
          editVersionMinor = $("editVersionMinor"),
          editVersionPatch = $("editVersionPatch"),
          editMajorDisplay = $("editMajorDisplay"),
          editMinorDisplay = $("editMinorDisplay"),
          editPatchDisplay = $("editPatchDisplay"),
          updateProjectBtn = $("updateProjectBtn"),
          editProjectCancelBtn = $("editProjectCancelBtn");
    editProjectBtn.addEventListener("click", () => {
      if (!currentProject) return;
      editProjectTitle.value = currentProject.title;
      editProjectDescription.value = currentProject.description;
      const parts = currentProject.version.split(".");
      editVersionMajor.value = parts[0] || 1;
      editVersionMinor.value = parts[1] || 0;
      editVersionPatch.value = parts[2] || 0;
      editMajorDisplay.textContent = editVersionMajor.value;
      editMinorDisplay.textContent = editVersionMinor.value;
      editPatchDisplay.textContent = editVersionPatch.value;
      showModal(editProjectModal);
    });
    editProjectCancelBtn.addEventListener("click", () => hideModal(editProjectModal));
    updateProjectBtn.addEventListener("click", () => {
      if (!currentProject) return;
      currentProject.title = editProjectTitle.value.trim() || currentProject.title;
      currentProject.description = editProjectDescription.value.trim();
      currentProject.version = editVersionMajor.value + "." + editVersionMinor.value + "." + editVersionPatch.value;
      currentProject.updated = new Date();
      updateProjectInfo();
      renderProjectList();
      saveProjectsToLocalStorage();
      hideModal(editProjectModal);
      logMessage("Project updated at " + formatDate(new Date(currentProject.updated)));
    });
    const runBtn = $("runBtn"),
          pauseBtn = $("pauseBtn"),
          stopBtn = $("stopBtn");
    runBtn.addEventListener("click", () => { htmlView.innerHTML = codeEditor.value; logMessage("Run executed."); });
    pauseBtn.addEventListener("click", () => {
      if (!isPaused) { isPaused = true; pauseBtn.textContent = "Resume"; logMessage("Paused."); }
      else { isPaused = false; pauseBtn.textContent = "Pause"; htmlView.innerHTML = codeEditor.value; logMessage("Resumed."); }
    });
    stopBtn.addEventListener("click", () => { htmlView.innerHTML = ""; isPaused = false; pauseBtn.textContent = "Pause"; logMessage("Stopped."); });
    // Fullscreen toggle and additional fullscreen buttons
    const fullscreenBtn = $("fullscreenBtn"),
          exitFullscreenBtn = $("exitFullscreenBtn"),
          fullscreenTaskbar = $("fullscreenTaskbar");
    fullscreenBtn.addEventListener("click", () => {
      document.querySelector(".code-area").style.display = "none";
      projectEditorModal.classList.add("fullscreen-mode");
      fullscreenTaskbar.style.display = "flex";
    });
    exitFullscreenBtn.addEventListener("click", () => {
      document.querySelector(".code-area").style.display = "block";
      projectEditorModal.classList.remove("fullscreen-mode");
      fullscreenTaskbar.style.display = "none";
    });
    // Fullscreen taskbar buttons functionality
    const fullscreenRunBtn = $("fullscreenRunBtn"),
          fullscreenPauseBtn = $("fullscreenPauseBtn"),
          fullscreenStopBtn = $("fullscreenStopBtn");
    fullscreenRunBtn.addEventListener("click", () => {
      htmlView.innerHTML = codeEditor.value;
      logMessage("Run executed.");
    });
    fullscreenPauseBtn.addEventListener("click", () => {
      if (!isPaused) { 
        isPaused = true; 
        fullscreenPauseBtn.textContent = "Resume"; 
        logMessage("Paused."); 
      } else { 
        isPaused = false; 
        fullscreenPauseBtn.textContent = "Pause"; 
        htmlView.innerHTML = codeEditor.value; 
        logMessage("Resumed."); 
      }
    });
    fullscreenStopBtn.addEventListener("click", () => {
      htmlView.innerHTML = "";
      isPaused = false;
      fullscreenPauseBtn.textContent = "Pause";
      logMessage("Stopped.");
    });
    const verticalResizer = $("verticalResizer");
    verticalResizer.addEventListener("mousedown", initVerticalResize);
    function initVerticalResize(e) { window.addEventListener("mousemove", doVerticalResize); window.addEventListener("mouseup", stopVerticalResize); }
    function doVerticalResize(e) {
      const rp = document.querySelector(".right-panel").getBoundingClientRect();
      let newH = e.clientY - rp.top; newH = Math.max(50, Math.min(newH, rp.height - 50));
      htmlView.style.flex = "none"; htmlView.style.height = newH + "px";
    }
    function stopVerticalResize(e) { window.removeEventListener("mousemove", doVerticalResize); window.removeEventListener("mouseup", stopVerticalResize); }
    function updateLineNumbers() {
      const lines = codeEditor.value.split("\n").length;
      const content = Array.from({ length: lines }, (_, i) => (i + 1).toString().padStart(2, "0")).join("\n");
      lineNumbers.textContent = content;
    }
    const codeEditor = $("codeEditor"),
          lineNumbers = $("lineNumbers");
    codeEditor.addEventListener("input", updateLineNumbers);
    codeEditor.addEventListener("scroll", () => { lineNumbers.scrollTop = codeEditor.scrollTop; });
    versionMajor.addEventListener("input", () => { majorDisplay.textContent = versionMajor.value; });
    versionMinor.addEventListener("input", () => { minorDisplay.textContent = versionMinor.value; });
    versionPatch.addEventListener("input", () => { patchDisplay.textContent = versionPatch.value; });
    editVersionMajor.addEventListener("input", () => { editMajorDisplay.textContent = editVersionMajor.value; });
    editVersionMinor.addEventListener("input", () => { editMinorDisplay.textContent = editVersionMinor.value; });
    editVersionPatch.addEventListener("input", () => { editPatchDisplay.textContent = editVersionPatch.value; });
    // Autosave with random delay (500-5000ms)
    function scheduleAutosave() {
      const delay = Math.floor(Math.random() * 4501) + 500;
      autosaveLabel.textContent = "Next autosave in " + delay + " ms";
      autosaveTimeoutId = setTimeout(() => {
        if (projectEditorModal.style.display === "flex" && currentProject) {
          currentProject.code = codeEditor.value;
          currentProject.updated = new Date();
          logMessage("Autosaved at " + formatDate(new Date(currentProject.updated)));
          renderProjectList();
          saveProjectsToLocalStorage();
        }
        scheduleAutosave();
      }, delay);
    }
    scheduleAutosave();
    // Template Selection functionality
    const selectTemplateBtn = $("selectTemplateBtn"),
          templateModal = $("templateModal"),
          templateSelectBtn = $("templateSelectBtn"),
          templateCancelBtn = $("templateCancelBtn");
    selectTemplateBtn.addEventListener("click", () => {
      showModal(templateModal);
    });
    const templateBoxes = document.querySelectorAll(".template-box");
    templateBoxes.forEach(box => {
      box.addEventListener("click", () => {
        templateBoxes.forEach(b => b.classList.remove("selected"));
        box.classList.add("selected");
        selectedTemplateKey = box.getAttribute("data-template");
      });
    });
    templateSelectBtn.addEventListener("click", () => {
      if(selectedTemplateKey && templates[selectedTemplateKey]) {
        selectedTemplateCode = templates[selectedTemplateKey].code;
        selectTemplateBtn.textContent = templates[selectedTemplateKey].name;
      }
      hideModal(templateModal);
    });
    templateCancelBtn.addEventListener("click", () => {
      hideModal(templateModal);
    });
  </script>
</body>
</html>
